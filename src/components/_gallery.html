<div class="gallery-component"
     style="--gallery-height: @@height;
            --gallery-radius: @@border-radius;
            --gallery-dot-color: @@dot-color;
            --gallery-dot-size: @@dot-size;
            --gallery-btn-size: @@btn-size;
            --gallery-bg: @@background-color;">
    <div class="gallery__container">
        <div class="gallery__images">
            <img src="@@img1" alt="Фото 1" class="gallery__image active" onerror="this.style.display='none'">
            <img src="@@img2" alt="Фото 2" class="gallery__image">
            <img src="@@img3" alt="Фото 3" class="gallery__image" onerror="this.style.display='none'">
            <img src="@@img4" alt="Фото 4" class="gallery__image" onerror="this.style.display='none'">
            <img src="@@img5" alt="Фото 5" class="gallery__image" onerror="this.style.display='none'">
        </div>

        <button class="gallery__btn gallery__btn--prev">
            <svg width="12" height="18" viewBox="0 0 12 18"><path d="M10 1L2 9L10 17" stroke="white" stroke-width="2"/></svg>
        </button>

        <button class="gallery__btn gallery__btn--next">
            <svg width="12" height="18" viewBox="0 0 12 18"><path d="M2 1L10 9L2 17" stroke="white" stroke-width="2"/></svg>
        </button>

        <div class="gallery__dots">
            <span class="gallery__dot active" data-index="0"></span>
            <span class="gallery__dot" data-index="1"></span>
            <span class="gallery__dot" data-index="2"></span>
            <span class="gallery__dot" data-index="3"></span>
            <span class="gallery__dot" data-index="4"></span>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const galleries = document.querySelectorAll('.gallery-component');

        galleries.forEach(gallery => {
            const images = gallery.querySelectorAll('.gallery__image');
            const dots = gallery.querySelectorAll('.gallery__dot');
            let currentIndex = 0;

            // Находим все видимые изображения
            function getVisibleItems() {
                const visibleImages = [];
                const visibleDots = [];

                images.forEach((img, index) => {
                    if (img.style.display !== 'none' && img.src) {
                        visibleImages.push({
                            element: img,
                            originalIndex: index
                        });
                        visibleDots.push({
                            element: dots[index],
                            originalIndex: index
                        });
                    }
                });

                return { visibleImages, visibleDots };
            }

            function showImage(index) {
                const { visibleImages, visibleDots } = getVisibleItems();

                if (visibleImages.length === 0) return;

                // Зацикливание через модуль
                const safeIndex = ((index % visibleImages.length) + visibleImages.length) % visibleImages.length;

                // Скрываем все
                images.forEach(img => img.classList.remove('active'));
                dots.forEach(dot => dot.classList.remove('active'));

                // Показываем нужные
                visibleImages[safeIndex].element.classList.add('active');
                visibleDots[safeIndex].element.classList.add('active');

                currentIndex = visibleImages[safeIndex].originalIndex;
            }

            // Кнопка "вперед"
            gallery.querySelector('.gallery__btn--next').addEventListener('click', () => {
                const { visibleImages } = getVisibleItems();
                if (visibleImages.length <= 1) return;

                currentIndex++;
                showImage(currentIndex);
            });

            // Кнопка "назад"
            gallery.querySelector('.gallery__btn--prev').addEventListener('click', () => {
                const { visibleImages } = getVisibleItems();
                if (visibleImages.length <= 1) return;

                currentIndex--;
                showImage(currentIndex);
            });

            // Точки
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    currentIndex = index;
                    showImage(currentIndex);
                });
            });

            // Проверяем начальное состояние
            setTimeout(() => {
                const { visibleImages } = getVisibleItems();
                if (visibleImages.length === 0) {
                    console.warn('Ни одно изображение не загружено!');
                } else {
                    console.log(`Загружено ${visibleImages.length} изображений`);
                    showImage(0); // Принудительно показываем первое
                }
            }, 100);
        });
    });
</script>